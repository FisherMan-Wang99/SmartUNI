<!-- pages/detail/detail.wxml -->
<!-- å¤´éƒ¨æ ‡é¢˜ -->
<view class="header">
  <view class="title">ğŸ“ æ™ºèƒ½é€‰æ ¡æ¨èç»“æœ</view>
  <view class="subtitle">åŸºäºæ‚¨çš„ä¸ªäººèƒŒæ™¯ç²¾å‡†åŒ¹é…</view>
</view>

<view class="container">
  <!-- æ·»åŠ è·³è½¬æŒ‰é’®åœ¨é¡µé¢é¡¶éƒ¨ -->
  <view class="header-actions">
      <button class="history-btn" bindtap="navigateToHistory">
        <text class="btn-icon">ğŸ“š</text>
        <text class="btn-text">å†å²è®°å½•</text>
      </button> 
    </view>
  <!-- å­¦ç”Ÿä¿¡æ¯æ¦‚è§ˆ -->
  <view class="student-card">
    <view class="student-header">
      <text class="student-name">{{studentInfo.name}} â€¢ {{studentInfo.intendedMajor}}</text>
    </view>
    <view class="student-stats">
      <view class="stat-item">
        <text class="stat-label">GPA</text>
        <text class="stat-value">{{studentInfo.gpa}}</text>
      </view>
      <view class="stat-item">
        <text class="stat-label">{{studentInfo.testScoreLabel}}</text>
        <text class="stat-value">{{studentInfo.testScore}}</text>
      </view>
      <view class="stat-item">
        <text class="stat-label">{{studentInfo.englishScoreLabel}}</text>
        <text class="stat-value">{{studentInfo.englishScore || 'æœªå¡«å†™'}}</text>
      </view>
    </view>
  </view>

  <!-- ç¬¬ä¸€åŒºåŸŸï¼šåŸºäºæ ‡åŒ–æˆç»©çš„è¯„ä¼° -->
  <view class="assessment-section standardized-assessment">
    <view class="section-divider">
      <text class="divider-icon">ğŸ“ˆ</text>
      <text class="divider-title">åŸºäºæ ‡åŒ–æˆç»©çš„è¯„ä¼°</text>
      <text class="divider-subtitle">å®Œå…¨åŸºäºGPAã€è€ƒè¯•åˆ†æ•°ç­‰é‡åŒ–æŒ‡æ ‡</text>
    </view>
    
    <!-- æ¨èå­¦æ ¡åˆ†ç±» -->
    <view class="categories">
      <!-- å†²åˆºå­¦æ ¡ -->
      <view class="category-section reach">
        <view class="category-header">
          <text class="category-icon">ğŸš€</text>
          <text class="category-title">å†²åˆºå­¦æ ¡ (Reach)</text>
          <text class="category-subtitle">å½•å–æ¦‚ç‡: 20-40%</text>
        </view>
        <view class="schools-list">
          <block wx:for="{{recommendations.reach_schools}}" wx:key="name">
            <view class="school-card">
              <view class="school-header">
                <text class="school-name">{{item.name}}</text>
                <text class="school-badge">#{{index + 1}}</text>
              </view>
              <view class="school-reasoning">
                <text class="reasoning-text">{{item.reasoning}}</text>
              </view>
              <view class="school-footer">
                <text class="level-tag reach-tag">{{item.level}}</text>
                <text wx:if="{{item.admission_probability}}" class="probability-tag">{{item.admission_probability}}% å½•å–æ¦‚ç‡</text>
              </view>
            </view>
          </block>
          <view wx:if="{{recommendations.reach_schools.length === 0}}" class="empty-state">
            <text>æš‚æ— å†²åˆºå­¦æ ¡æ¨è</text>
          </view>
        </view>
      </view>

      <!-- åŒ¹é…å­¦æ ¡ -->
      <view class="category-section match">
        <view class="category-header">
          <text class="category-icon">â­</text>
          <text class="category-title">åŒ¹é…å­¦æ ¡ (Match)</text>
          <text class="category-subtitle">å½•å–æ¦‚ç‡: 40-70%</text>
        </view>
        <view class="schools-list">
          <block wx:for="{{recommendations.match_schools}}" wx:key="name">
            <view class="school-card">
              <view class="school-header">
                <text class="school-name">{{item.name}}</text>
                <text class="school-badge">#{{index + 1}}</text>
              </view>
              <view class="school-reasoning">
                <text class="reasoning-text">{{item.reasoning}}</text>
              </view>
              <view class="school-footer">
                <text class="level-tag match-tag">{{item.level}}</text>
                <text wx:if="{{item.admission_probability}}" class="probability-tag">{{item.admission_probability}}% å½•å–æ¦‚ç‡</text>
              </view>
            </view>
          </block>
          <view wx:if="{{recommendations.match_schools.length === 0}}" class="empty-state">
            <text>æš‚æ— åŒ¹é…å­¦æ ¡æ¨è</text>
          </view>
        </view>
      </view>

      <!-- ä¿åº•å­¦æ ¡ -->
      <view class="category-section safety">
        <view class="category-header">
          <text class="category-icon">ğŸ›¡ï¸</text>
          <text class="category-title">ä¿åº•å­¦æ ¡ (Safety)</text>
          <text class="category-subtitle">å½•å–æ¦‚ç‡: 70%+</text>
        </view>
        <view class="schools-list">
          <block wx:for="{{recommendations.safety_schools}}" wx:key="name">
            <view class="school-card">
              <view class="school-header">
                <text class="school-name">{{item.name}}</text>
                <text class="school-badge">#{{index + 1}}</text>
              </view>
              <view class="school-reasoning">
                <text class="reasoning-text">{{item.reasoning}}</text>
              </view>
              <view class="school-footer">
                <text class="level-tag safety-tag">{{item.level}}</text>
                <text wx:if="{{item.admission_probability}}" class="probability-tag">{{item.admission_probability}}% å½•å–æ¦‚ç‡</text>
              </view>
            </view>
          </block>
          <view wx:if="{{recommendations.safety_schools.length === 0}}" class="empty-state">
            <text>æš‚æ— ä¿åº•å­¦æ ¡æ¨è</text>
          </view>
        </view>
      </view>
    </view>
  </view>
  
  <!-- ç¬¬äºŒåŒºåŸŸï¼šAIé€‰æ ¡åˆ†ææŠ¥å‘Š -->
  <view class="assessment-section ai-analysis" wx:if="{{hasData && recommendationReason}}">
    <view class="section-divider">
      <text class="divider-icon">ğŸ¤–</text>
      <text class="divider-title">AIé€‰æ ¡åˆ†ææŠ¥å‘Š</text>
      <text class="divider-subtitle">åŸºäºå­¦ç”Ÿç‰¹æ€§å’Œä¸ªäººå–œå¥½çš„è¯„ä¼°</text>
    </view>
    
    <view class="ai-report-content">
      <text class="ai-report-text">{{recommendationReason}}</text>
    </view>
  </view>
    
  <!-- è°ƒè¯•ä¿¡æ¯ï¼ˆå¼€å‘æ—¶å¯ä»¥æ˜¾ç¤ºï¼Œä¸Šçº¿åéšè—ï¼‰ -->
  <view class="debug-info" wx:if="{{false}}"> <!-- è®¾ç½®ä¸ºfalseéšè—è°ƒè¯•ä¿¡æ¯ -->
    <text class="debug-title">è°ƒè¯•ä¿¡æ¯</text>
    <text>å­¦ç”Ÿä¿¡æ¯: {{JSON.stringify(studentInfo)}}</text>
    <text>æ¨èç»“æœ: {{JSON.stringify(recommendations)}}</text>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="bottom-buttons">
    <button class="back-btn" bindtap="restartAssessment">é‡æ–°è¯„ä¼°</button>
    <button class="next-btn" bindtap="saveRecommendation">ä¿å­˜æµ‹è¯•ç»“æœ</button>
  </view>
</view>












